#!@BASH@

## Copyright (C) 2018 Robert Krawitz
##
## This program is free software; you can redistribute it and/or modify
## it under the terms of the GNU General Public License as published by
## the Free Software Foundation; either version 2, or (at your option)
## any later version.
##
## This program is distributed in the hope that it will be useful,
## but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
## GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with this program.  If not, see <https://www.gnu.org/licenses/>.


[[ -n $STP_TEST_DEBUG ]] && DEBUG=echo

[[ -z $STP_TEST_SUITE || -z $STP_TEST_PROFILE ]] && STP_TEST_PROFILE=full

set -e

TEST_PRINTERS="escp2-r1800 escp2-3880 pcl-g_4 pcl-g_5c"

case "$STP_TEST_PROFILE" in
    full)
	$DEBUG ./run-testpattern-2 -s
	$DEBUG ./run-testpattern-2 \
	       -oPageSize,Resolution=MIN,DitherAlgorithm=VeryFast
	$DEBUG ./run-testpattern-2 -s -dDitherAlgorithm=VeryFast \
	       -dResolution=MIN -dPageSize=MIN \
	       -o TPMode,ColorCorrection,InkType,UseGloss
	;;
    fast)
	$DEBUG ./run-testpattern-2 -s -dDitherAlgorithm=VeryFast \
	       -dResolution=MIN -dPageSize=MIN -dColorCorrection=Raw \
	       -o InkType -o InkSet,RawChannels -o Duplex \
	       -o MediaType -o InputSlot -o FullBleed -o UseGloss \
	       -o Orientation -o LabelSeparator -o Resolution -T 720 "$@"
	$DEBUG ./run-testpattern-2 -s -dDitherAlgorithm=VeryFast \
	       -dResolution=MIN -dPageSize=MIN \
	       -o TPMode,ColorCorrection,InkType,UseGloss \
	       @MINIMAL_PRINTERS_TO_TEST@
	;;
    valgrind)
	$DEBUG ./run-testpattern-2 -s -v -v -dDitherAlgorithm=VeryFast \
    	       -dResolution=MIN -dPageSize=MIN -o InkType \
	       -o InkSet,RawChannels -o Duplex -o MediaType -o InputSlot \
	       -o FullBleed -o UseGloss -o Orientation -o LabelSeparator "$@"
	$DEBUG ./run-testpattern-2 -s -v -v -dDitherAlgorithm=VeryFast \
	       -dResolution=MIN -dPageSize=MIN \
	       -o TPMode,ColorCorrection,InkType,UseGloss "$@" \
	       @MINIMAL_PRINTERS_TO_TEST@
	;;
    checksums)
	export STP_DEBUG=$(printf "0x%x" $((0x8000000 | ${STP_DEBUG:-0})))
	$DEBUG ./run-testpattern-2 -q -M - "$@"
	$DEBUG ./run-testpattern-2 -F -s -q -M - \
	       -o PageSize,Resolution=MIN,DitherAlgorithm=VeryFast "$@"
	$DEBUG ./run-testpattern-2 -F -s -q -M - -dDitherAlgorithm=VeryFast \
	       -dResolution=MIN -dPageSize=MIN \
	       -o TPMode,ColorCorrection,InkType,UseGloss "$@"
	;;
    minimal)
	$DEBUG ./run-testpattern-2 -s -dDitherAlgorithm=VeryFast \
	       -dResolution=MIN -dPageSize=MIN -dColorCorrection=Raw \
	       -o InkType -o InkSet,RawChannels -o Duplex \
	       -o MediaType -o InputSlot -o FullBleed -o UseGloss \
	       -o Orientation -o LabelSeparator -o Resolution -T 720 \
	       "$@" @MINIMAL_PRINTERS_TO_TEST@
	;;
    valgrind-minimal)
	$DEBUG ./run-testpattern-2 -s -v -v -dDitherAlgorithm=VeryFast \
	       -dResolution=MIN -dPageSize=MIN -o InkType \
	       -o InkSet,RawChannels -o Duplex -o MediaType -o InputSlot \
	       -o FullBleed -o UseGloss -o Orientation -o LabelSeparator "$@" \
	       @MINIMAL_PRINTERS_TO_TEST@
	;;
    *)
	echo "Unknown test profile '$STP_TEST_PROFILE'"
	exit 77
	;;
esac
